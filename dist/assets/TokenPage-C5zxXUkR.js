import{d,g as l,o as f,c as m,u as _,h as p,s as h}from"./index-B8ZSdwpR.js";import{s as r}from"./toastnotification-Bjh8Hj8x.js";import{A as u}from"./App-Cr4Cy-db.js";import{m as k,a as g}from"./makeHttpReq-DbGmgVk1.js";const U=d({__name:"TokenPage",setup(w){var n;const c=(n=_().query)==null?void 0:n.code_verifier;async function i(){const s=p();try{const t={grant_type:"authorization_code",client_id:"9ca9a351-601f-41da-90d8-d2c86f80dc6c",redirect_uri:"http://localhost:5173/callback",code_verifier:c,code:s==null?void 0:s.authorizationCode},[o,{user:e,userAccount:a}]=await Promise.all([k("oauth/token","POST",t),g("user_data","POST",t)]);(a==null?void 0:a.account_status)==="Active"?(h({user:{name:e==null?void 0:e.name,email:e==null?void 0:e.email,userId:e==null?void 0:e.id,role:e==null?void 0:e.role},userAccount:{leftDays:a==null?void 0:a.leftDays,account_status:a==null?void 0:a.account_status},token:{accessToken:o==null?void 0:o.access_token,refreshToken:o==null?void 0:o.refresh_token}}),window.location.href="/dashboard"):window.location.href="/user_blocked"}catch(t){t.message==="Unexpected end of JSON input"?(r("Failed Login ..., please try again..."),setTimeout(()=>window.location.href=u.baseURL+"/auth/redirect",1500)):r(t.message)}}return l(async()=>{await i()}),(s,t)=>(f(),m("h1",null,"processing... please wait..."))}});export{U as default};
